version: '3.9'

# For production builds, explicitly specify .env file to avoid .env.local
# Usage: docker-compose --env-file .env build

services:
  api:
    build:
      context: .
      dockerfile: api/Dockerfile
    env_file:
      - api/.env  # Your actual environment variables
    environment:
      - WEB_ORIGIN=http://localhost:5173
    ports:
      - '8080:8080'

  web:
    build:
      context: .
      dockerfile: web/Dockerfile
      args:
        # Build-time arguments from root .env file
        VITE_API_URL: ${VITE_API_URL}
        VITE_SUPABASE_URL: ${VITE_SUPABASE_URL}
        VITE_SUPABASE_ANON_KEY: ${VITE_SUPABASE_ANON_KEY}
    depends_on:
      - api
    ports:
      - '5173:80'
